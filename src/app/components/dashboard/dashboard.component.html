<div class="dashboard-container">
  <app-header></app-header>
  <app-toast></app-toast>
  
  <div class="dashboard-content">
    <div class="dashboard-header">
      <div>
        <h1>Dashboard</h1>
        <p>Resumen de tu negocio de préstamos</p>
      </div>
      <button class="btn btn-primary" (click)="exportToExcel()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
        </svg>
        Exportar a Excel
      </button>
    </div>

    <!-- Métricas -->
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(139, 21, 56, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Total Prestado</h3>
          <p class="metric-value">{{ formatCurrency(metrics.totalPrestamos || 0) }}</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(196, 30, 58, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--secondary-color)" stroke-width="2">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Pendiente por Cobrar</h3>
          <p class="metric-value">{{ formatCurrency(metrics.totalPendiente || 0) }}</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(40, 167, 69, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2">
            <path d="M20 6L9 17l-5-5"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Total Recuperado</h3>
          <p class="metric-value">{{ formatCurrency(metrics.totalRecuperado || 0) }}</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(255, 193, 7, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#856404" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Clientes Activos</h3>
          <p class="metric-value">{{ metrics.clientesActivos || 0 }}</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(139, 21, 56, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary-color)" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Préstamos Activos</h3>
          <p class="metric-value">{{ metrics.prestamosActivos || 0 }}</p>
        </div>
      </div>

      <div class="metric-card">
        <div class="metric-icon" style="background: rgba(220, 53, 69, 0.1);">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--error)" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 8v4M12 16h.01"/>
          </svg>
        </div>
        <div class="metric-content">
          <h3>Préstamos Vencidos</h3>
          <p class="metric-value">{{ metrics.prestamosVencidos || 0 }}</p>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="charts-grid">
      <div class="chart-card">
        <h2>Estado de Cuotas</h2>
        <div class="chart-container">
          <canvas baseChart
            [data]="cuotasChartData"
            [options]="cuotasChartOptions"
            type="doughnut">
          </canvas>
        </div>
      </div>

      <div class="chart-card">
        <h2>Préstamos por Estado</h2>
        <div class="chart-container">
          <canvas baseChart
            [data]="prestamosChartData"
            [options]="prestamosChartOptions"
            type="bar">
          </canvas>
        </div>
      </div>

      <div class="chart-card chart-card-wide">
        <h2>Evolución de Pagos (Últimos 6 Meses)</h2>
        <div class="chart-container">
          <canvas baseChart
            [data]="pagosChartData"
            [options]="pagosChartOptions"
            type="line">
          </canvas>
        </div>
      </div>
    </div>

    <!-- Tablas recientes -->
    <div class="recent-data-grid">
      <div class="recent-card">
        <div class="recent-header">
          <h2>Préstamos Recientes</h2>
          <a routerLink="/prestamos" class="btn btn-secondary">Ver Todos</a>
        </div>
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Monto</th>
                <th>Estado</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let loan of recentLoans">
                <td>{{ loan.clienteNombre }}</td>
                <td>{{ formatCurrency(loan.monto) }}</td>
                <td>
                  <span class="badge" [ngClass]="{
                    'badge-success': loan.estado === 'completado',
                    'badge-warning': loan.estado === 'activo',
                    'badge-danger': loan.estado === 'vencido'
                  }">
                    {{ loan.estado }}
                  </span>
                </td>
                <td>{{ loan.fechaInicio | date:'short' }}</td>
              </tr>
              <tr *ngIf="recentLoans.length === 0">
                <td colspan="4" class="text-center">No hay préstamos registrados</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="recent-card">
        <div class="recent-header">
          <h2>Pagos Recientes</h2>
          <a routerLink="/pagos" class="btn btn-secondary">Ver Todos</a>
        </div>
        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Cliente</th>
                <th>Monto</th>
                <th>Tipo</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let payment of recentPayments">
                <td>{{ payment.clienteNombre }}</td>
                <td>{{ formatCurrency(payment.monto) }}</td>
                <td>
                  <span class="badge badge-info">
                    {{ payment.tipo === 'cuota' ? 'Cuota' : payment.tipo === 'abono' ? 'Abono' : 'Completo' }}
                  </span>
                </td>
                <td>{{ payment.fecha | date:'short' }}</td>
              </tr>
              <tr *ngIf="recentPayments.length === 0">
                <td colspan="4" class="text-center">No hay pagos registrados</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

